<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Leilyce nail atelier | ãƒã‚¤ãƒ«ã‚«ã‚¦ãƒ³ã‚»ãƒªãƒ³ã‚°ãƒ•ã‚©ãƒ¼ãƒ </title>

  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@500;700&family=Zen+Kaku+Gothic+New:wght@400;500;700&display=swap" rel="stylesheet">

  <style>
    * { box-sizing: border-box; }

    body{
      margin:0;
      padding:0 16px;
      color:#2b2b2b;
      font-family:"Zen Kaku Gothic New", system-ui, -apple-system, sans-serif;

      /* GitHub repo ã«ç½®ãèƒŒæ™¯ç”»åƒ */
      background-image: url("./background_blue.png");
      background-size: cover;
      background-position: center;
      background-attachment: fixed;
    }

    /* ã†ã£ã™ã‚‰ç™½ã„ãƒ™ãƒ¼ãƒ«ã§èª­ã¿ã‚„ã™ã */
    .veil{
      min-height: 100vh;
      padding: 22px 0 48px;
      background: rgba(255,255,255,0.62);
      backdrop-filter: blur(1px);
    }

    .container{
      max-width: 520px;
      margin: 0 auto;
    }

    .brand{
      text-align:center;
      margin: 8px 0 18px;
    }

    .brand .logoText{
      font-family: "Dancing Script", cursive;
      font-size: 42px;
      line-height: 1.05;
      color: #1e3a5f; /* é’å¯„ã‚Šä¸Šå“ */
      text-shadow: 0 2px 14px rgba(30,58,95,0.12);
      margin: 0;
    }

    .brand .subTitle{
      margin: 8px 0 0;
      font-weight: 700;
      font-size: 16px;
      letter-spacing: .08em;
      color: #2f3e55;
    }

    .card{
      background: rgba(255,255,255,0.78);
      border: 1px solid rgba(30,58,95,0.10);
      box-shadow: 0 10px 30px rgba(30,58,95,0.10);
      border-radius: 16px;
      padding: 18px 16px;
    }

    h2{
      font-size: 16px;
      margin: 18px 0 8px;
      padding-left: 10px;
      border-left: 4px solid rgba(30,58,95,0.45);
      color: #1e3a5f;
    }

    label{
      display:block;
      margin-top: 14px;
      font-weight: 700;
      font-size: 14px;
      color:#263446;
    }

    input[type="text"], textarea, select, input[type="file"]{
      width:100%;
      padding: 12px;
      font-size: 16px;
      border-radius: 10px;
      border: 1px solid rgba(30,58,95,0.22);
      margin-top: 8px;
      background: rgba(255,255,255,0.9);
      outline: none;
    }

    textarea{ resize: vertical; }

    .help{
      margin-top: 6px;
      font-size: 12px;
      color: rgba(38,52,70,0.75);
      line-height: 1.4;
    }

    .checkbox-group{
      margin-top: 10px;
      display: grid;
      gap: 10px;
    }

    .checkbox-group label{
      display:flex;
      align-items:center;
      gap:10px;
      font-weight: 500;
      margin: 0;
      padding: 10px 10px;
      border-radius: 12px;
      border: 1px solid rgba(30,58,95,0.14);
      background: rgba(255,255,255,0.72);
    }

    .checkbox-group input[type="checkbox"]{
      transform: scale(1.25);
    }

    button[type="submit"]{
      margin-top: 18px;
      width:100%;
      padding: 14px 12px;
      background: linear-gradient(135deg, #1e3a5f, #2f6aa3);
      color:#fff;
      font-size: 17px;
      font-weight: 800;
      border:none;
      border-radius: 12px;
      cursor:pointer;
      box-shadow: 0 10px 24px rgba(30,58,95,0.18);
    }
    button[type="submit"]:disabled{
      opacity: .65;
      cursor: not-allowed;
    }

    .result{
      margin-top: 18px;
      padding: 14px;
      border-radius: 14px;
      border: 1px solid rgba(30,58,95,0.14);
      background: rgba(255,255,255,0.78);
    }

    .result pre{
      white-space: pre-wrap;
      background: rgba(30,58,95,0.05);
      padding: 12px;
      border-left: 4px solid rgba(30,58,95,0.22);
      border-radius: 10px;
      overflow-wrap: anywhere;
      margin: 0;
    }

    .result img{
      width:100%;
      margin-top: 14px;
      border-radius: 12px;
      border: 1px solid rgba(30,58,95,0.18);
      background: #fff;
    }

    .caption{
      text-align:center;
      font-size: 12px;
      color: rgba(38,52,70,0.70);
      margin-top: 8px;
    }

    /* loading popup */
    #loadingPopup{
      display:none; /* â†æœ€åˆã¯çµ¶å¯¾ã«éè¡¨ç¤º */
      position:fixed;
      inset:0;
      background: rgba(255,255,255,0.82);
      z-index: 9999;
      align-items:center;
      justify-content:center;
      padding: 18px;
      text-align:center;
      color:#1e3a5f;
      font-weight: 900;
      font-size: 18px;
      font-family:"Zen Kaku Gothic New", sans-serif;
      backdrop-filter: blur(2px);
    }

    .loadingBox{
      width: 100%;
      max-width: 420px;
      background: rgba(255,255,255,0.92);
      border: 1px solid rgba(30,58,95,0.14);
      border-radius: 16px;
      padding: 18px 14px;
      box-shadow: 0 14px 34px rgba(30,58,95,0.12);
    }
    .spinner{
      width: 36px;
      height: 36px;
      margin: 10px auto 8px;
      border-radius: 50%;
      border: 4px solid rgba(30,58,95,0.18);
      border-top-color: rgba(30,58,95,0.70);
      animation: spin 1s linear infinite;
    }
    @keyframes spin{ to{ transform: rotate(360deg); } }
  </style>
</head>

<body>
  <div class="veil">
    <div class="container">
      <div class="brand">
        <h1 class="logoText">Leilyce nail atelier</h1>
        <div class="subTitle">ãƒã‚¤ãƒ«ã‚«ã‚¦ãƒ³ã‚»ãƒªãƒ³ã‚°ãƒ•ã‚©ãƒ¼ãƒ </div>
      </div>

      <div class="card">
        <form id="nailForm">
          <h2>å¿…é ˆï¼šçˆªã®å†™çœŸ</h2>
          <label for="nail_photo">çˆªã®å†™çœŸã‚’æ’®å½±ã—ã¦ãã ã•ã„ï¼ˆå¿…é ˆï¼‰</label>
          <input
            type="file"
            id="nail_photo"
            name="nail_photo"
            accept="image/*"
            capture="environment"
            required
          />
          <div class="help">â€»ã‚¹ãƒãƒ›ã®ã‚«ãƒ¡ãƒ©ãŒèµ·å‹•ã—ã¾ã™ã€‚æ˜ã‚‹ã„å ´æ‰€ã§ãƒ”ãƒ³ãƒˆã‚’åˆã‚ã›ã¦æ’®å½±ã—ã¦ãã ã•ã„ã€‚</div>

          <h2>åŸºæœ¬æƒ…å ±</h2>
          <label for="age">å¹´é½¢å±¤</label>
          <select id="age" name="age">
            <option value="">é¸æŠã—ã¦ãã ã•ã„</option>
            <option value="10ä»£">10ä»£</option>
            <option value="20ä»£">20ä»£</option>
            <option value="30ä»£">30ä»£</option>
            <option value="40ä»£">40ä»£</option>
            <option value="50ä»£ä»¥ä¸Š">50ä»£ä»¥ä¸Š</option>
          </select>

          <label for="lifestyle">è·æ¥­ã‚„ãƒ©ã‚¤ãƒ•ã‚¹ã‚¿ã‚¤ãƒ«</label>
          <input type="text" id="lifestyle" name="lifestyle" placeholder="ä¾‹ï¼šã‚ªãƒ•ã‚£ã‚¹ãƒ¯ãƒ¼ã‚¯ã€æ¥å®¢æ¥­ã€åœ¨å®…ãƒ¯ãƒ¼ã‚¯ ãªã©"/>

          <label for="nail_duration">ä»–ã‚µãƒ­ãƒ³ã§ã®ã‚¸ã‚§ãƒ«ãƒã‚¤ãƒ«ã®æŒã¡ã¯ã©ã®ãã‚‰ã„ã§ã—ãŸã‹ï¼Ÿï¼ˆä»»æ„ï¼‰</label>
          <select id="nail_duration" name="nail_duration">
            <option value="">é¸æŠã—ã¦ãã ã•ã„</option>
            <option value="1é€±é–“æœªæº€">1é€±é–“æœªæº€</option>
            <option value="1ã€œ2é€±é–“">1ã€œ2é€±é–“</option>
            <option value="2ã€œ3é€±é–“">2ã€œ3é€±é–“</option>
            <option value="3ã€œ4é€±é–“">3ã€œ4é€±é–“</option>
            <option value="4é€±é–“ä»¥ä¸Š">4é€±é–“ä»¥ä¸Š</option>
            <option value="è¦šãˆã¦ã„ãªã„">è¦šãˆã¦ã„ãªã„</option>
          </select>

          <h2>ãƒã‚¤ãƒ«ã®å¸Œæœ›ã‚¤ãƒ¡ãƒ¼ã‚¸</h2>
          <label>ä»Šå›ã®ãƒã‚¤ãƒ«ã®ç›®çš„ï¼ˆè¤‡æ•°é¸æŠå¯ï¼‰</label>
          <div class="checkbox-group">
            <label><input type="checkbox" name="purpose" value="ä»•äº‹ç”¨"> ä»•äº‹ã«åˆã‚ã›ã¦</label>
            <label><input type="checkbox" name="purpose" value="æ°—åˆ†è»¢æ›"> æ°—åˆ†ã‚’ä¸Šã’ãŸã„</label>
            <label><input type="checkbox" name="purpose" value="ã‚¤ãƒ™ãƒ³ãƒˆ"> ã‚¤ãƒ™ãƒ³ãƒˆï¼ˆæ—…è¡Œãƒ»æ¨ã—æ´»ãªã©ï¼‰</label>
            <label><input type="checkbox" name="purpose" value="äººã¨ä¼šã†"> äººã¨ä¼šã†äºˆå®šãŒã‚ã‚‹</label>
            <label><input type="checkbox" name="purpose" value="ãªã‚“ã¨ãªã"> ãªã‚“ã¨ãªãã‚­ãƒ¬ã‚¤ã«ã—ãŸã„</label>
          </div>

          <label>å¸Œæœ›ã™ã‚‹ãƒã‚¤ãƒ«ã®é›°å›²æ°—ï¼ˆè¤‡æ•°é¸æŠå¯ï¼‰</label>
          <div class="checkbox-group">
            <label><input type="checkbox" name="vibe" value="ä¸Šå“"> ä¸Šå“</label>
            <label><input type="checkbox" name="vibe" value="å¯æ„›ã„"> å¯æ„›ã„</label>
            <label><input type="checkbox" name="vibe" value="å¤§äººã£ã½ã„"> å¤§äººã£ã½ã„</label>
            <label><input type="checkbox" name="vibe" value="ãƒŠãƒãƒ¥ãƒ©ãƒ«"> ãƒŠãƒãƒ¥ãƒ©ãƒ«</label>
            <label><input type="checkbox" name="vibe" value="ã‚¯ãƒ¼ãƒ«"> ã‚¯ãƒ¼ãƒ«</label>
            <label><input type="checkbox" name="vibe" value="ãƒˆãƒ¬ãƒ³ãƒ‰æ„Ÿ"> ãƒˆãƒ¬ãƒ³ãƒ‰æ„Ÿã‚ã‚‹</label>
            <label><input type="checkbox" name="vibe" value="è‡ªåˆ†ã‚‰ã—ã"> è‡ªåˆ†ã‚‰ã—ã</label>
          </div>

          <label for="avoid_colors">è‹¦æ‰‹ãƒ»é¿ã‘ãŸã„ãƒ†ã‚¤ã‚¹ãƒˆã‚„ã‚«ãƒ©ãƒ¼ï¼ˆè‡ªç”±è¨˜è¿°ï¼‰</label>
          <textarea id="avoid_colors" name="avoid_colors" rows="3" placeholder="ä¾‹ï¼šæ´¾æ‰‹ãªèµ¤ã€ãƒ©ãƒ¡ã€é»’ç³»ãŒè‹¦æ‰‹..."></textarea>

          <button type="submit">é€ä¿¡ã™ã‚‹</button>
        </form>

        <div class="result" id="result" style="display:none;">
          <h2>ã‚ãªãŸã®ãƒã‚¤ãƒ«ãƒ—ãƒ©ãƒ³</h2>
          <pre id="planText"></pre>
          <img id="nailImage" src="" alt="ãƒã‚¤ãƒ«ã‚µãƒ³ãƒ—ãƒ«ç”»åƒ" style="display:none;" />
          <div class="caption" id="imgCaption" style="display:none;">â€»AIã«ã‚ˆã‚‹ãƒã‚¤ãƒ«ã‚¤ãƒ¡ãƒ¼ã‚¸ï¼ˆå†™çœŸã‚’å…ƒã«ç·¨é›†ï¼‰</div>
        </div>
      </div>
    </div>
  </div>

  <!-- å‡¦ç†ä¸­ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ— -->
  <div id="loadingPopup">
    <div class="loadingBox">
      <div>å‡¦ç†ä¸­ã§ã™â€¦ ã—ã°ã‚‰ããŠå¾…ã¡ãã ã•ã„ ğŸ’…</div>
      <div class="spinner"></div>
      <div class="help">ç”»åƒç·¨é›†ã¯å°‘ã—æ™‚é–“ãŒã‹ã‹ã‚‹ã“ã¨ãŒã‚ã‚Šã¾ã™ã€‚</div>
    </div>
  </div>

  <script>
    const API_URL = "https://makeup-enz8.onrender.com/api/makeup";

    document.getElementById("nailForm").addEventListener("submit", async function(event) {
      event.preventDefault();

      const popup = document.getElementById("loadingPopup");
      const form = event.target;
      const submitBtn = form.querySelector('button[type="submit"]');

      // é€ä¿¡æ™‚ã ã‘è¡¨ç¤º
      popup.style.display = "flex";
      submitBtn.disabled = true;
      submitBtn.textContent = "é€ä¿¡ä¸­...";

      try {
        const fd = new FormData(form); // â† ç”»åƒä»˜ããªã®ã§ FormData ãŒæ­£è§£

        const response = await fetch(API_URL, {
          method: "POST",
          body: fd
        });

        const text = await response.text(); // â† JSONä»¥å¤–ãŒè¿”ã£ã¦ãã‚‹ã‚±ãƒ¼ã‚¹ã«å‚™ãˆã¦ä¸€æ—¦text
        let result;
        try {
          result = JSON.parse(text);
        } catch (e) {
          throw new Error("JSONãƒ‘ãƒ¼ã‚¹å¤±æ•—: " + text.slice(0, 200));
        }

        if (!response.ok) {
          throw new Error(result.error || ("HTTP " + response.status));
        }

        // è¡¨ç¤º
        document.getElementById("planText").textContent =
          result.plan || "(ãƒ—ãƒ©ãƒ³ãŒå–å¾—ã§ãã¾ã›ã‚“ã§ã—ãŸ)";

        const img = document.getElementById("nailImage");
        const cap = document.getElementById("imgCaption");

        if (result.image_data_url) {
          img.src = result.image_data_url;
          img.style.display = "block";
          cap.style.display = "block";
        } else {
          img.style.display = "none";
          cap.style.display = "none";
        }

        document.getElementById("result").style.display = "block";
        form.style.display = "none";

      } catch (err) {
        alert("ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸï¼š " + err.message);
        console.error(err);

      } finally {
        popup.style.display = "none";
        submitBtn.disabled = false;
        submitBtn.textContent = "é€ä¿¡ã™ã‚‹";
      }
    });
  </script>
</body>
</html>
